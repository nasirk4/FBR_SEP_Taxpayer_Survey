{% extends "survey/base.html" %}
{% load static %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/respondent_info_styles.css' %}">
    <script src="{% static 'js/respondent_info_script.js' %}"></script>
{% endblock %}

<!-- {% block progress_width %}25%{% endblock %} -->
<!-- {% block current_step %}2{% endblock %} -->

{% block content %}
<h1 class="page-title">Respondent Information</h1>

<div class="info-box">
    Please provide your basic information. Required fields are marked with <span class="required-star">*</span>.
</div>

<form method="POST" id="respondent-form">
    {% csrf_token %}

    <div class="section">
        <h2 class="section-title">üìã Basic Information</h2>

        <div class="form-grid-wrapper">
            <div class="form-group">
                <label for="full_name" class="form-label required">Full Name<span class="required-star">*</span></label>
                <input type="text" id="full_name" name="full_name" class="form-control"
                        placeholder="Enter your full name" required
                        value="{{ request.session.respondent_info.full_name|default:'' }}">
            </div>

            <div class="form-group">
                <label for="email" class="form-label required">Email Address<span class="required-star">*</span></label>
                <input type="email" id="email" name="email" class="form-control"
                        placeholder="your.email@example.com" required
                        value="{{ request.session.respondent_info.email|default:'' }}">
            </div>

            <div class="form-group">
                <label for="district_search" class="form-label required">District<span class="required-star">*</span></label>
                <div class="dropdown-container">
                    <input type="text" id="district_search" class="form-control"
                            placeholder="Type to search districts..."
                            autocomplete="off" required
                            value="{{ request.session.respondent_info.district|default:'' }}">
                    <div id="district_dropdown" class="custom-dropdown">
                        {% for district in districts %}
                            <div class="dropdown-option" data-value="{{ district }}">{{ district }}</div>
                        {% endfor %}
                        <div class="dropdown-option custom-option" data-value="__custom__">My district is not in the list</div>
                    </div>
                </div>
                <input type="text" id="custom_district" name="custom_district" class="form-control"
                        placeholder="Please enter your district name"
                        style="display: none; margin-top: 5px;">
                <input type="hidden" id="final_district" name="district" value="{{ request.session.respondent_info.district|default:'' }}">
            </div>

            <div class="form-group">
                <label for="mobile" class="form-label">Mobile Number (optional)</label>
                <input type="tel" id="mobile" name="mobile" class="form-control"
                        placeholder="0300XXXXXXX"
                        value="{{ request.session.respondent_info.mobile|default:'' }}">
            </div>

            <div class="form-group">
                <label for="province" class="form-label required">Province<span class="required-star">*</span></label>
                <select id="province" name="province" class="form-control" required>
                    <option value="">Select your province</option>
                    <option value="balochistan" {% if request.session.respondent_info.province == 'balochistan' %}selected{% endif %}>Balochistan</option>
                    <option value="ict" {% if request.session.respondent_info.province == 'ict' %}selected{% endif %}>ICT</option>
                    <option value="kpk" {% if request.session.respondent_info.province == 'kpk' %}selected{% endif %}>KPK</option>
                    <option value="punjab" {% if request.session.respondent_info.province == 'punjab' %}selected{% endif %}>Punjab</option>
                    <option value="sindh" {% if request.session.respondent_info.province == 'sindh' %}selected{% endif %}>Sindh</option>
                </select>
            </div>
        </div>
    </div>

    <div class="section" role="group" aria-labelledby="section-title" aria-describedby="roles-description">
        <h2 id="section-title" class="section-title">üíº Professional Role(s)</h2>

        <p id="roles-description" class="form-label required">
            Please select at least one professional role<span class="required-star" aria-hidden="true">*</span>:
        </p>

        <div class="checkbox-group" role="group" aria-labelledby="roles-description">
            <div class="checkbox-item" role="checkbox" aria-checked="false" tabindex="0">
                <input type="checkbox" id="legalPractitioner" name="professional_role" value="legal"
                    {% if 'legal' in request.session.respondent_info.professional_roles|default:'' %}checked{% endif %}
                    aria-labelledby="legalLabel">
                <label id="legalLabel" for="legalPractitioner">Legal Practitioner</label>
            </div>

            <div class="checkbox-item" role="checkbox" aria-checked="false" tabindex="0">
                <input type="checkbox" id="customsAgent" name="professional_role" value="customs"
                    {% if 'customs' in request.session.respondent_info.professional_roles|default:'' %}checked{% endif %}
                    aria-labelledby="customsLabel">
                <label id="customsLabel" for="customsAgent">Customs Agent</label>
            </div>
        </div>

        <!-- Hidden input for JavaScript functionality -->
        <input type="hidden" id="professional_role_combined" name="professional_role_combined"
               value="{{ request.session.respondent_info.professional_role_combined|default:'' }}">

        <div id="roleError" class="role-error" role="alert" aria-live="assertive" aria-hidden="true">
            <span aria-hidden="true">‚ö†Ô∏è</span> Please select at least one professional role to continue.
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">üéØ Primary Practice Areas (Optional)</h2>
        <p>Please indicate your main areas of professional practice (select all that apply):</p>

        <div class="practice-areas-group">
            <div class="practice-area-item">
                <input type="checkbox" id="practice_income_tax" name="practice_areas" value="income_tax"
                    {% if 'income_tax' in request.session.respondent_info.practice_areas|default:'' %}checked{% endif %}>
                <label for="practice_income_tax">Income Tax</label>
            </div>
            <div class="practice-area-item">
                <input type="checkbox" id="practice_sales_tax" name="practice_areas" value="sales_tax"
                    {% if 'sales_tax' in request.session.respondent_info.practice_areas|default:'' %}checked{% endif %}>
                <label for="practice_sales_tax">Sales Tax / Federal Excise Duty</label>
            </div>
            <div class="practice-area-item">
                <input type="checkbox" id="practice_customs" name="practice_areas" value="customs"
                    {% if 'customs' in request.session.respondent_info.practice_areas|default:'' %}checked{% endif %}>
                <label for="practice_customs">Customs</label>
            </div>
            <div class="practice-area-item">
                <input type="checkbox" id="practice_international" name="practice_areas" value="international"
                    {% if 'international' in request.session.respondent_info.practice_areas|default:'' %}checked{% endif %}>
                <label for="practice_international">International Taxation</label>
            </div>
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">üìä Years of Experience</h2>
        <p>Please indicate your experience for each <strong>selected</strong> role:</p>

        <!-- Remove display: none and let JavaScript handle visibility -->
        <div class="experience-section" id="legalExperience">
            <h3>Legal Practitioner Experience<span class="required-star">*</span></h3>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="legal1-5" name="experience_legal" value="1-5 years" required
                            {% if request.session.respondent_info.experience_legal == '1-5 years' %}checked{% endif %}>
                    <label for="legal1-5">1-5 years</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="legal6-10" name="experience_legal" value="6-10 years" required
                            {% if request.session.respondent_info.experience_legal == '6-10 years' %}checked{% endif %}>
                    <label for="legal6-10">6-10 years</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="legal10plus" name="experience_legal" value="More than 10 years" required
                            {% if request.session.respondent_info.experience_legal == 'More than 10 years' %}checked{% endif %}>
                    <label for="legal10plus">More than 10 years</label>
                </div>
            </div>
        </div>

        <!-- Remove display: none and let JavaScript handle visibility -->
        <div class="experience-section" id="customsExperience">
            <h3>Customs Agent Experience<span class="required-star">*</span></h3>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="customs1-5" name="experience_customs" value="1-5 years" required
                            {% if request.session.respondent_info.experience_customs == '1-5 years' %}checked{% endif %}>
                    <label for="customs1-5">1-5 years</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="customs6-10" name="experience_customs" value="6-10 years" required
                            {% if request.session.respondent_info.experience_customs == '6-10 years' %}checked{% endif %}>
                    <label for="customs6-10">6-10 years</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="customs10plus" name="experience_customs" value="More than 10 years" required
                            {% if request.session.respondent_info.experience_customs == 'More than 10 years' %}checked{% endif %}>
                    <label for="customs10plus">More than 10 years</label>
                </div>
            </div>
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">üìû Follow-up Research (Optional)</h2>
        <p>To deepen our understanding of the survey findings, we may conduct brief follow-up interviews. Would you be willing to be contacted for a 30-45 minute interview?</p>

        <div class="radio-group">
            <div class="radio-item">
                <input type="radio" id="kii_yes" name="kii_consent" value="yes"
                        {% if request.session.respondent_info.kii_consent == 'yes' %}checked{% endif %}>
                <label for="kii_yes">Yes, I am willing to be contacted at the email/phone provided</label>
            </div>
            <div class="radio-item">
                <input type="radio" id="kii_no" name="kii_consent" value="no"
                        {% if request.session.respondent_info.kii_consent == 'no' %}checked{% endif %}>
                <label for="kii_no">No, I prefer not to participate in follow-up interviews</label>
            </div>
        </div>
    </div>

    <div class="buttons">
        <button type="button" class="btn btn-back" onclick="handleBackNavigation('{% url 'survey:welcome' %}')">‚Üê Back</button>
        <button type="submit" class="btn btn-next">Next ‚Üí</button>
    </div>
</form>
{% endblock %}