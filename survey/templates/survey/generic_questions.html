{% extends "survey/base.html" %}
{% load static %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/generic_questions_styles.css' %}">
    <script src="{% static 'js/generic_questions_script.js' %}"></script>
{% endblock %}

<!-- {% block progress_width %}50%{% endblock %} -->
<!-- {% block current_step %}3{% endblock %} -->

{% block content %}
<div class="form-container">
    <h1 class="page-title">General Questions</h1>

    <div class="info-box">
        This section covers overall perception about FBR's digital systems and their impact on professional practice.
    </div>

    {% if error %}
    <div class="error-box" id="error-box" role="alert">
        <div class="error-icon">⚠️</div>
        <div class="error-message">{{ error }}</div>
    </div>
    {% endif %}

    <form method="POST" id="genericQuestionsForm" novalidate>
        {% csrf_token %}
        <input type="hidden" name="respondent_id" value="{{ respondent_id }}">
        <!-- Hidden input to pass generic_answers for JavaScript -->
        <input type="hidden" id="generic_answers" value="{{ generic_answers_json }}">

        <!-- G1: Policy Impact Matrix -->
        <div class="question-card">
            <div class="question-text">G1. In the last 12 months, to what extent have FBR policy and legal reforms affected the following aspects of your practice?</div>
            <table class="table table-bordered matrix-table">
                <thead>
                    <tr>
                        <th scope="col">Aspect</th>
                        <th scope="col">Very Positive</th>
                        <th scope="col">Positive</th>
                        <th scope="col">Neutral</th>
                        <th scope="col">Negative</th>
                        <th scope="col">Very Negative</th>
                        <th scope="col">N/A</th>
                        <th scope="col">Don't Know</th>
                    </tr>
                </thead>
                <tbody>
                    {% for aspect, name in g1_aspects %}
                    <tr>
                        <td>{{ name }}</td>
                        {% for value, label in g1_matrix_options %}
                        <td>
                            <div class="radio-item">
                                <input type="radio" id="g1_{{ aspect }}_{{ value }}" name="g1_{{ aspect }}" value="{{ value }}" required
                                       aria-required="true">
                                <label for="g1_{{ aspect }}_{{ value }}">{{ label }}</label>
                            </div>
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div id="g1_error_inline" class="validation-error-inline" style="display: none;" role="alert">
                ⚠️ Please select an option for each aspect in G1.
            </div>
        </div>

        <!-- G2: System Impact Matrix -->
        <div class="question-card">
            <div class="question-text">G2. In the last 12 months, to what extent have FBR digital system changes (e.g., IRIS, WeBOC, PSW) affected the following aspects of your practice?</div>
            <table class="table table-bordered matrix-table">
                <thead>
                    <tr>
                        <th scope="col">Aspect</th>
                        <th scope="col">Very Positive</th>
                        <th scope="col">Positive</th>
                        <th scope="col">Neutral</th>
                        <th scope="col">Negative</th>
                        <th scope="col">Very Negative</th>
                        <th scope="col">N/A</th>
                        <th scope="col">Don't Know</th>
                    </tr>
                </thead>
                <tbody>
                    {% for aspect, name in g2_aspects %}
                    <tr>
                        <td>{{ name }}</td>
                        {% for value, label in g2_matrix_options %}
                        <td>
                            <div class="radio-item">
                                <input type="radio" id="g2_{{ aspect }}_{{ value }}" name="g2_{{ aspect }}" value="{{ value }}" required
                                       aria-required="true">
                                <label for="g2_{{ aspect }}_{{ value }}">{{ label }}</label>
                            </div>
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div id="g2_error_inline" class="validation-error-inline" style="display: none;" role="alert">
                ⚠️ Please select an option for each aspect in G2.
            </div>
        </div>

        <!-- G3: Technical System Reliability -->
        <div class="question-card">
            <div class="question-text">G3. In the last 12 months, how often have you encountered technical issues with FBR digital platforms (e.g., system downtime, errors)?</div>
            <div class="radio-group compact">
                {% for value, label in g3_options %}
                <div class="radio-item">
                    <input type="radio" id="g3_{{ value }}" name="g3_technical_issues" value="{{ value }}" required
                           {% if generic_answers.g3_technical_issues == value %}checked{% endif %}
                           aria-required="true" onchange="toggleG4Section()">
                    <label for="g3_{{ value }}">{{ label }}</label>
                </div>
                {% endfor %}
            </div>
            <div id="g3_technical_issues_error_inline" class="validation-error-inline" style="display: none;" role="alert">
                ⚠️ Please select an option for G3.
            </div>
        </div>

        <!-- G4: Follow-up on Technical Issues (Conditional) -->
        <div class="question-card" id="g4_section"
            {% if generic_answers.g3_technical_issues != 'daily' and generic_answers.g3_technical_issues != 'weekly' and generic_answers.g3_technical_issues != 'monthly' and generic_answers.g3_technical_issues != 'rarely' %}style="display: none;"{% endif %}>
            <div class="question-text">G4. Thinking about the technical issues you encountered, how significantly did they disrupt your operations?</div>
            <div class="radio-group compact">
                {% for value, label in g4_options %}
                <div class="radio-item">
                    <input type="radio" id="g4_{{ value }}" name="g4_disruption" value="{{ value }}"
                        {% if generic_answers.g4_disruption == value %}checked{% endif %}
                        {% if generic_answers.g3_technical_issues == 'daily' or generic_answers.g3_technical_issues == 'weekly' or generic_answers.g3_technical_issues == 'monthly' or generic_answers.g3_technical_issues == 'rarely' %}required{% endif %}
                        aria-required="true">
                    <label for="g4_{{ value }}">{{ label }}</label>
                </div>
                {% endfor %}
            </div>
            <div id="g4_disruption_error_inline" class="validation-error-inline" style="display: none;" role="alert">
                ⚠️ Please select an option for G4.
            </div>
        </div>

        <!-- G5: Digital Literacy Needs -->
        <div class="question-card">
            <div class="question-text">G5. In the last 12 months, to what extent have FBR digitization efforts increased your need for digital literacy training for your staff?</div>
            <div class="radio-group compact">
                {% for value, label in g5_options %}
                <div class="radio-item">
                    <input type="radio" id="g5_{{ value }}" name="g5_digital_literacy" value="{{ value }}" required
                           {% if generic_answers.g5_digital_literacy == value %}checked{% endif %}
                           aria-required="true">
                    <label for="g5_{{ value }}">{{ label }}</label>
                </div>
                {% endfor %}
            </div>
            <div id="g5_digital_literacy_error_inline" class="validation-error-inline" style="display: none;" role="alert">
                ⚠️ Please select an option for G5.
            </div>
        </div>

        <!-- Form Buttons -->
        <div class="buttons">
            <a href="{% url 'survey:respondent_info' %}" class="btn btn-back">← Back</a>
            <button type="submit" class="btn btn-next">Next →</button>
        </div>
    </form>
</div>
{% endblock %}