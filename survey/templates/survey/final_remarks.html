{% extends "survey/base.html" %}
{% load static %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/final_remarks_styles.css' %}">
    <script src="{% static 'js/final_remarks_script.js' %}"></script>
{% endblock %}

{% block content %}
<h1 class="page-title">Final Remarks</h1>

<div class="info-box">
    Please provide any additional suggestions or remarks to improve FBR's taxation system.
</div>

{% if error %}
<div class="error-box" id="error-box" role="alert">
    <div class="error-icon">‚ö†Ô∏è</div>
    <div class="error-message">{{ error }}</div>
</div>
{% endif %}

<form method="POST" id="finalForm"
      data-save-url="{% url 'survey:final_remarks' %}"
      data-confirmation-url="{% url 'survey:confirmation' %}"
      data-back-url="{% url 'survey:cross_system_perspectives' %}">
    {% csrf_token %}

    <div class="section">
        <h2 class="section-title">üí° Additional Suggestions for FBR's System</h2>

        <div class="form-group">
            <label for="final_remarks" class="form-label">Your suggestions or remarks:</label>
            <textarea id="final_remarks" name="final_remarks" class="form-control" rows="6" required
                      placeholder="Please share any additional feedback, suggestions, or concerns regarding FBR's system...">{{ request.session.final_remarks|default:'' }}</textarea>
        </div>

        <div class="info-box" style="background: #f3e5f5; border-left-color: #9c27b0;">
            <strong>Note:</strong> Your feedback is invaluable for improving Pakistan's taxation system.
            Please be specific and constructive in your suggestions.
        </div>
    </div>
    
    <div class="section">
        <h2 class="section-title">üìù Feedback on the Questionnaire</h2>

        <div class="form-group">
            <label for="survey_feedback" class="form-label">
                **Q. Do you have any feedback on the structure, length, or clarity of this survey questionnaire?**
            </label>
            <textarea id="survey_feedback" name="survey_feedback" class="form-control" rows="4"
                      placeholder="Optional: Please tell us what you think about the survey itself...">{{ request.session.survey_feedback|default:'' }}</textarea>
        </div>
    </div>
    <div class="buttons">
        <button type="button" class="btn btn-back" onclick="handleBackNavigation()">‚Üê Back</button>
        <button type="button" class="btn btn-submit" onclick="confirmSubmission()">Submit Survey</button>
    </div>
</form>

<div id="confirmationModal" class="modal" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="modal-content">
        <h3 id="modal-title" style="color: var(--fbr-blue); margin-bottom: 1rem;">Confirm Submission</h3>
        <p>Are you sure you want to submit your survey? Once submitted, you cannot make changes.</p>

        <div class="submission-summary">
            <h4>Survey Sections Completed:</h4>
            <ul>
                <li>‚úÖ Respondent Information</li>
                <li>‚úÖ General Questions</li>
                <li>‚úÖ Role-Specific Questions</li>
                <li>{% if request.session.cross_system_answers and not request.session.cross_system_answers.skipped %}‚úÖ{% else %}‚è≠Ô∏è{% endif %} Cross-System Perspectives</li>
                <li>‚úÖ Final Remarks</li>
            </ul>
        </div>

        <div class="modal-buttons">
            <button type="button" class="btn btn-back" onclick="reviewAnswers()">Review My Answers</button>
            <button type="button" class="btn btn-submit" onclick="submitForm()">Yes, Submit Survey</button>
        </div>
    </div>
</div>
{% endblock %}